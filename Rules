#!/usr/bin/env ruby

##############################################################################
# SITEMAP, ROBOTS & S3SITEDEPLOY
##############################################################################
['/sitemap.xml', '/robots.txt'].each do |r|
    compile r do
        filter :erb
        write item.identifier.to_s
    end
end

###############################################################################
# ARTICLES
###############################################################################
compile '/article/**/*/**/*/' do
end
route '/article/**/*/**/*/' do
    '/assets' + item.identifier.chop + fingerprint(item[:filename]) +
    '.' + item[:extension]
end

compile '/article/**/*/' do
    filter :erb
    filter :kramdown
    layout 'article'
end


##############################################################################
# Default
##############################################################################
compile '/**/*.html' do
  filter :erb
  layout '/default.*'
  write item.identifier.without_ext + '/index.html'
end
layout '/**/*', :erb
